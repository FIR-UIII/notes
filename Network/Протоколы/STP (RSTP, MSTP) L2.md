#STP #Петля #loop
Spanning Tree Protocol - защита от широковещательных штормов. Причина - петля. 

1. Выбирается корневой коммутатор
2. Выбирается корневой порт на некорневом коммутаторе
3. Выбор назначенного порта

При соединении 2+ коммутаторов / маршрутизаторов, автоматически формируются STP пакеты.
```
Switch#show spanning-tree
	This bridge is the root - означает что этот коммутатор корневой

Interface Role Sts Cost Prio.Nbr Type
--------- ---- --- ---- ------- -----
Fa0/1     Desg FWD  19  128.1    P2p >>> назначенный порт
Fa0/2     Desg FWD  19  128.2    P2p >>> назначенный порт
Fa0/2     Root FWD  19  128.2    P2p >>> корневой порт (указывает на корн.коммутатор)
Fa0/1     Altn BLK  19  128.1    P2p >>> резервный порт, ЗАБЛОКИРОВАН
```
В среднем, у STP на переконфигурирование портов уходит около 15 сек. в случае обрыва линии
### RSTP - более быстрый режим STP, чтобы включить его нужно просто, на всех коммутаторах:
```
Switch#conf t
Switch(config)#spanning-tree mode rapid-pvst
Switch#show sp
VLAN0001
Spanning tree enabled protocol rstp >>> подтверждает включение RSTP
```
В среднем, у RSTP на переконфигурирование портов уходит около 1 мсек. в случае обрыва линии

### Как найти петлю
1. Включить сниффер

**Признаки**
у IP пакетов низкий TTL
большое количество сетевых пакетов с идентичным значениями IP ID
большое кол-во пакетов на адрес ff::